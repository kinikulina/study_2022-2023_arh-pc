     1                                  
     2                                  %include 'in_out.asm'
     3                              <1> ;---------------   slen  -------------------
     4                              <1> ; Функция вычисления длины сообщения
     5                              <1> slen:                     
     6 00000000 53                  <1>     push    ebx             
     7 00000001 89C3                <1>     mov     ebx, eax        
     8                              <1>     
     9                              <1> nextchar:                   
    10 00000003 803800              <1>     cmp     byte [eax], 0   
    11 00000006 7403                <1>     jz      finished        
    12 00000008 40                  <1>     inc     eax             
    13 00000009 EBF8                <1>     jmp     nextchar        
    14                              <1>     
    15                              <1> finished:
    16 0000000B 29D8                <1>     sub     eax, ebx
    17 0000000D 5B                  <1>     pop     ebx             
    18 0000000E C3                  <1>     ret                     
    19                              <1> 
    20                              <1> 
    21                              <1> ;---------------  sprint  -------------------
    22                              <1> ; Функция печати сообщения
    23                              <1> ; входные данные: mov eax,<message>
    24                              <1> sprint:
    25 0000000F 52                  <1>     push    edx
    26 00000010 51                  <1>     push    ecx
    27 00000011 53                  <1>     push    ebx
    28 00000012 50                  <1>     push    eax
    29 00000013 E8E8FFFFFF          <1>     call    slen
    30                              <1>     
    31 00000018 89C2                <1>     mov     edx, eax
    32 0000001A 58                  <1>     pop     eax
    33                              <1>     
    34 0000001B 89C1                <1>     mov     ecx, eax
    35 0000001D BB01000000          <1>     mov     ebx, 1
    36 00000022 B804000000          <1>     mov     eax, 4
    37 00000027 CD80                <1>     int     80h
    38                              <1> 
    39 00000029 5B                  <1>     pop     ebx
    40 0000002A 59                  <1>     pop     ecx
    41 0000002B 5A                  <1>     pop     edx
    42 0000002C C3                  <1>     ret
    43                              <1> 
    44                              <1> 
    45                              <1> ;----------------  sprintLF  ----------------
    46                              <1> ; Функция печати сообщения с переводом строки
    47                              <1> ; входные данные: mov eax,<message>
    48                              <1> sprintLF:
    49 0000002D E8DDFFFFFF          <1>     call    sprint
    50                              <1> 
    51 00000032 50                  <1>     push    eax
    52 00000033 B80A000000          <1>     mov     eax, 0AH
    53 00000038 50                  <1>     push    eax
    54 00000039 89E0                <1>     mov     eax, esp
    55 0000003B E8CFFFFFFF          <1>     call    sprint
    56 00000040 58                  <1>     pop     eax
    57 00000041 58                  <1>     pop     eax
    58 00000042 C3                  <1>     ret
    59                              <1> 
    60                              <1> ;---------------  sread  ----------------------
    61                              <1> ; Функция считывания сообщения
    62                              <1> ; входные данные: mov eax,<buffer>, mov ebx,<N>
    63                              <1> sread:
    64 00000043 53                  <1>     push    ebx
    65 00000044 50                  <1>     push    eax
    66                              <1>    
    67 00000045 BB00000000          <1>     mov     ebx, 0
    68 0000004A B803000000          <1>     mov     eax, 3
    69 0000004F CD80                <1>     int     80h
    70                              <1> 
    71 00000051 5B                  <1>     pop     ebx
    72 00000052 59                  <1>     pop     ecx
    73 00000053 C3                  <1>     ret
    74                              <1>     
    75                              <1> ;------------- iprint  ---------------------
    76                              <1> ; Функция вывода на экран чисел в формате ASCII
    77                              <1> ; входные данные: mov eax,<int>
    78                              <1> iprint:
    79 00000054 50                  <1>     push    eax             
    80 00000055 51                  <1>     push    ecx             
    81 00000056 52                  <1>     push    edx             
    82 00000057 56                  <1>     push    esi             
    83 00000058 B900000000          <1>     mov     ecx, 0          
    84                              <1>     
    85                              <1> divideLoop:
    86 0000005D 41                  <1>     inc     ecx             
    87 0000005E BA00000000          <1>     mov     edx, 0          
    88 00000063 BE0A000000          <1>     mov     esi, 10  
    89 00000068 F7FE                <1>     idiv    esi    
    90 0000006A 83C230              <1>     add     edx, 48  
    91 0000006D 52                  <1>     push    edx   
    92 0000006E 83F800              <1>     cmp     eax, 0   
    93 00000071 75EA                <1>     jnz     divideLoop  
    94                              <1> 
    95                              <1> printLoop:
    96 00000073 49                  <1>     dec     ecx       
    97 00000074 89E0                <1>     mov     eax, esp  
    98 00000076 E894FFFFFF          <1>     call    sprint   
    99 0000007B 58                  <1>     pop     eax    
   100 0000007C 83F900              <1>     cmp     ecx, 0   
   101 0000007F 75F2                <1>     jnz     printLoop  
   102                              <1> 
   103 00000081 5E                  <1>     pop     esi   
   104 00000082 5A                  <1>     pop     edx    
   105 00000083 59                  <1>     pop     ecx   
   106 00000084 58                  <1>     pop     eax           
   107 00000085 C3                  <1>     ret
   108                              <1> 
   109                              <1> 
   110                              <1> ;--------------- iprintLF   --------------------
   111                              <1> ; Функция вывода на экран чисел в формате ASCII
   112                              <1> ; входные данные: mov eax,<int>
   113                              <1> iprintLF:
   114 00000086 E8C9FFFFFF          <1>     call    iprint          
   115                              <1> 
   116 0000008B 50                  <1>     push    eax             
   117 0000008C B80A000000          <1>     mov     eax, 0Ah        
   118 00000091 50                  <1>     push    eax             
   119 00000092 89E0                <1>     mov     eax, esp       
   120 00000094 E876FFFFFF          <1>     call    sprint          
   121 00000099 58                  <1>     pop     eax             
   122 0000009A 58                  <1>     pop     eax             
   123 0000009B C3                  <1>     ret
   124                              <1> 
   125                              <1> ;----------------- atoi  ---------------------
   126                              <1> ; Функция преобразования ascii-код символа в целое число
   127                              <1> ; входные данные: mov eax,<int>
   128                              <1> atoi:
   129 0000009C 53                  <1>     push    ebx             
   130 0000009D 51                  <1>     push    ecx             
   131 0000009E 52                  <1>     push    edx             
   132 0000009F 56                  <1>     push    esi             
   133 000000A0 89C6                <1>     mov     esi, eax        
   134 000000A2 B800000000          <1>     mov     eax, 0          
   135 000000A7 B900000000          <1>     mov     ecx, 0          
   136                              <1>  
   137                              <1> .multiplyLoop:
   138 000000AC 31DB                <1>     xor     ebx, ebx        
   139 000000AE 8A1C0E              <1>     mov     bl, [esi+ecx]
   140 000000B1 80FB30              <1>     cmp     bl, 48 
   141 000000B4 7C14                <1>     jl      .finished 
   142 000000B6 80FB39              <1>     cmp     bl, 57  
   143 000000B9 7F0F                <1>     jg      .finished 
   144                              <1>  
   145 000000BB 80EB30              <1>     sub     bl, 48 
   146 000000BE 01D8                <1>     add     eax, ebx
   147 000000C0 BB0A000000          <1>     mov     ebx, 10  
   148 000000C5 F7E3                <1>     mul     ebx  
   149 000000C7 41                  <1>     inc     ecx   
   150 000000C8 EBE2                <1>     jmp     .multiplyLoop  
   151                              <1>  
   152                              <1> .finished:
   153 000000CA 83F900              <1>     cmp     ecx, 0  
   154 000000CD 7407                <1>     je      .restore   
   155 000000CF BB0A000000          <1>     mov     ebx, 10  
   156 000000D4 F7F3                <1>     div     ebx     
   157                              <1>  
   158                              <1> .restore:
   159 000000D6 5E                  <1>     pop     esi   
   160 000000D7 5A                  <1>     pop     edx    
   161 000000D8 59                  <1>     pop     ecx  
   162 000000D9 5B                  <1>     pop     ebx 
   163 000000DA C3                  <1>     ret
   164                              <1> 
   165                              <1> 
   166                              <1> ;------------- quit   ---------------------
   167                              <1> ; Функция завершения программы
   168                              <1> quit:
   169 000000DB BB00000000          <1>     mov     ebx, 0      
   170 000000E0 B801000000          <1>     mov     eax, 1      
   171 000000E5 CD80                <1>     int     80h
   172 000000E7 C3                  <1>     ret
     3                                  SECTION .data
     4 00000000 726561646D652E7478-     filename db 'readme.txt', 0h ; Имя файла
     4 00000009 7400               
     5 0000000B D092D0B2D0B5D0B4D0-     msg db 'Введите строку для записи в файл: ', 0h ; Сообщение
     5 00000014 B8D182D0B520D181D1-
     5 0000001D 82D180D0BED0BAD183-
     5 00000026 20D0B4D0BBD18F20D0-
     5 0000002F B7D0B0D0BFD0B8D181-
     5 00000038 D0B820D0B220D184D0-
     5 00000041 B0D0B9D0BB3A2000   
     6                                  SECTION .bss
     7 00000000 <res FFh>               contents resb 255 ; переменная для вводимой строки
     8                                  SECTION .text
     9                                  global _start
    10                                  _start:
    11                                  ; --- Печать сообщения `msg`
    12 000000E8 B8[0B000000]            mov eax,msg
    13 000000ED E81DFFFFFF              call sprint
    14                                  ; ---- Запись введеной с клавиатуры строки в `contents`
    15 000000F2 B9[00000000]            mov ecx, contents
    16 000000F7 BAFF000000              mov edx, 255
    17 000000FC E842FFFFFF              call sread
    18                                  ; --- Открытие существующего файла (`sys_open`)
    19 00000101 B902000000              mov ecx, 2 ; открываем для записи (2)
    20 00000106 BB[00000000]            mov ebx, filename
    21 0000010B B805000000              mov eax, 5
    22 00000110 CD80                    int 80h
    23                                  ; --- Запись дескриптора файла в `esi`
    24 00000112 89C6                    mov esi, eax
    25                                  ; --- Расчет длины введенной строки
    26 00000114 B8[00000000]            mov eax, contents ; в `eax` запишется количество
    27 00000119 E8E2FEFFFF              call slen ; введенных байтов
    28                                  ; --- Записываем в файл `contents` (`sys_write`)
    29 0000011E 89C2                    mov edx, eax
    30 00000120 B9[00000000]            mov ecx, contents
    31 00000125 89F3                    mov ebx, esi
    32 00000127 B804000000              mov eax, 4
    33 0000012C CD80                    int 80h
    34                                  ; --- Закрываем файл (`sys_close`)
    35 0000012E 89F3                    mov ebx, esi
    36 00000130 B806000000              mov eax, 6
    37 00000135 CD80                    int 80h
    38 00000137 E89FFFFFFF              call quit
